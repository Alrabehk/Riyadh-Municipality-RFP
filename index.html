<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>منصة إعداد كراسات الشروط والمواصفات — أمانة منطقة الرياض</title>
<style>
:root {
  --bg:#fafafa;--surface:#fff;--surface-hover:#f7f7f7;--border:#e8e8e8;--border-strong:#d0d0d0;
  --text-primary:#1a1a1a;--text-secondary:#6b6b6b;--text-tertiary:#999;
  --accent:#0071e3;--accent-light:#e8f2fd;--accent-hover:#005bb5;
  --success:#28a745;--success-light:#e8f5e9;--warning:#f5a623;--warning-light:#fff8e1;
  --danger:#d32f2f;--danger-light:#fce4ec;
  --shadow-sm:0 1px 3px rgba(0,0,0,.04);--shadow-md:0 4px 12px rgba(0,0,0,.06);--shadow-lg:0 8px 30px rgba(0,0,0,.08);
  --radius:12px;--radius-sm:8px;--radius-xs:6px;
  --nav-width:230px;--header-height:54px;
  --font:-apple-system,'Segoe UI','SF Pro Display','Helvetica Neue',sans-serif;
  --transition:.2s cubic-bezier(.4,0,.2,1);
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--font);background:var(--bg);color:var(--text-primary);font-size:14px;line-height:1.6;-webkit-font-smoothing:antialiased;overflow:hidden;height:100vh}

header{position:fixed;top:0;left:0;right:0;height:var(--header-height);background:rgba(255,255,255,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:100}
.logo{font-size:15px;font-weight:600;letter-spacing:-.3px;display:flex;align-items:center;gap:10px}
.logo-icon{width:28px;height:28px;background:var(--text-primary);border-radius:7px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:700}
.header-left{display:flex;align-items:center;gap:12px}
.header-btn{background:none;border:none;cursor:pointer;width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);transition:var(--transition);font-size:16px}
.header-btn:hover{background:var(--surface-hover);color:var(--text-primary)}
.user-badge{display:flex;align-items:center;gap:8px;padding:4px 12px 4px 6px;border-radius:20px;background:var(--surface-hover);cursor:pointer;transition:var(--transition);border:1px solid transparent;font-size:13px}
.user-badge:hover{border-color:var(--border)}
.user-avatar{width:26px;height:26px;border-radius:50%;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600}

aside{position:fixed;top:var(--header-height);right:0;bottom:0;width:var(--nav-width);background:var(--surface);border-left:1px solid var(--border);padding:16px 12px;overflow-y:auto;z-index:50}
.nav-section{margin-bottom:24px}
.nav-section-title{font-size:11px;font-weight:600;color:var(--text-tertiary);letter-spacing:.5px;padding:0 12px;margin-bottom:6px}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:var(--radius-sm);cursor:pointer;transition:var(--transition);color:var(--text-secondary);font-size:13.5px;font-weight:450;border:1px solid transparent}
.nav-item:hover{background:var(--surface-hover);color:var(--text-primary)}
.nav-item.active{background:var(--text-primary);color:#fff;font-weight:500}
.nav-icon{font-size:16px;width:20px;text-align:center;flex-shrink:0}
.nav-badge{margin-right:auto;background:var(--accent);color:#fff;font-size:10px;font-weight:600;padding:1px 7px;border-radius:10px}

main{margin-top:var(--header-height);margin-right:var(--nav-width);height:calc(100vh - var(--header-height));overflow-y:auto}
.view{display:none;padding:32px;min-height:100%}.view.active{display:block}
.view-builder{padding:0;display:none}.view-builder.active{display:flex}

.page-title{font-size:26px;font-weight:600;letter-spacing:-.5px;margin-bottom:4px}
.page-subtitle{font-size:14px;color:var(--text-secondary);margin-bottom:28px}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px 22px;transition:var(--transition)}
.stat-card:hover{box-shadow:var(--shadow-md)}
.stat-label{font-size:12px;color:var(--text-tertiary);font-weight:500;margin-bottom:8px}
.stat-value{font-size:28px;font-weight:600;letter-spacing:-1px}
.stat-change{font-size:12px;margin-top:6px;color:var(--success);font-weight:500}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.section-title{font-size:17px;font-weight:600;letter-spacing:-.3px}

.data-table{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.data-table table{width:100%;border-collapse:collapse}
.data-table th{text-align:right;padding:12px 16px;font-size:11.5px;font-weight:600;color:var(--text-tertiary);border-bottom:1px solid var(--border);background:var(--bg)}
.data-table td{padding:14px 16px;font-size:13.5px;border-bottom:1px solid var(--border)}
.data-table tr:last-child td{border-bottom:none}
.data-table tr:hover td{background:var(--surface-hover)}

.status-chip{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:500}
.status-draft{background:#f0f0f0;color:var(--text-secondary)}
.status-review{background:var(--warning-light);color:#e67e00}
.status-approved{background:var(--success-light);color:var(--success)}
.status-published{background:var(--accent-light);color:var(--accent)}

.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 18px;border-radius:var(--radius-sm);font-size:13.5px;font-weight:500;cursor:pointer;transition:var(--transition);border:1px solid transparent;font-family:inherit;white-space:nowrap}
.btn-primary{background:var(--text-primary);color:#fff;border-color:var(--text-primary)}.btn-primary:hover{background:#333}
.btn-accent{background:var(--accent);color:#fff}.btn-accent:hover{background:var(--accent-hover)}
.btn-outline{background:transparent;border-color:var(--border-strong);color:var(--text-primary)}.btn-outline:hover{background:var(--surface-hover)}
.btn-ghost{background:transparent;color:var(--text-secondary);padding:6px 12px}.btn-ghost:hover{color:var(--text-primary);background:var(--surface-hover)}
.btn-sm{padding:5px 12px;font-size:12.5px}
.btn-icon{width:32px;height:32px;padding:0;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-xs);background:none;border:1px solid var(--border);cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-family:inherit}
.btn-icon:hover{background:var(--surface-hover);color:var(--text-primary)}

.form-group{margin-bottom:20px}
.form-label{display:block;font-size:12.5px;font-weight:600;color:var(--text-secondary);margin-bottom:6px}
.form-input,.form-select,.form-textarea{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:var(--radius-sm);font-size:14px;font-family:inherit;color:var(--text-primary);background:var(--surface);transition:var(--transition);outline:none}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,113,227,.1)}
.form-textarea{resize:vertical;min-height:80px;line-height:1.5}
.form-hint{font-size:11.5px;color:var(--text-tertiary);margin-top:4px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}

.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:var(--transition)}
.card:hover{box-shadow:var(--shadow-sm)}
.card-title{font-size:15px;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px}

.builder-container{display:flex;height:calc(100vh - var(--header-height));width:100%}
.builder-main{flex:1;overflow-y:auto;padding:28px 32px;border-left:1px solid var(--border)}
.builder-preview{width:400px;background:var(--surface);border-right:1px solid var(--border);overflow-y:auto;flex-shrink:0}

.stepper{display:flex;align-items:center;gap:0;margin-bottom:28px;padding:12px 0;overflow-x:auto;flex-wrap:nowrap}
.step-item{display:flex;align-items:center;gap:8px;cursor:pointer;padding:6px 12px;border-radius:20px;white-space:nowrap;transition:var(--transition);font-size:12.5px;color:var(--text-tertiary);font-weight:500;flex-shrink:0}
.step-item:hover{background:var(--surface-hover);color:var(--text-secondary)}
.step-item.active{background:var(--text-primary);color:#fff}
.step-item.completed{color:var(--success)}
.step-num{width:22px;height:22px;border-radius:50%;border:1.5px solid var(--border-strong);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;flex-shrink:0}
.step-item.active .step-num{background:#fff;color:var(--text-primary);border-color:#fff}
.step-item.completed .step-num{background:var(--success);color:#fff;border-color:var(--success)}
.step-divider{width:20px;height:1px;background:var(--border);flex-shrink:0}

.preview-header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);padding:14px 20px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text-secondary);display:flex;align-items:center;justify-content:space-between;z-index:10}
.preview-content{padding:20px;font-size:13px;line-height:1.8}
.preview-section{margin-bottom:18px;padding-bottom:14px;border-bottom:1px solid var(--border)}
.preview-section:last-child{border-bottom:none}
.preview-section-title{font-size:13.5px;font-weight:600;color:var(--text-primary);margin-bottom:6px}
.preview-field{display:flex;gap:8px;margin-bottom:3px;font-size:12.5px}
.preview-field-label{font-weight:600;color:var(--text-secondary);min-width:110px;flex-shrink:0}
.preview-placeholder{color:var(--text-tertiary);font-style:italic}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:200}
.modal-overlay.active{display:flex}
.modal{background:var(--surface);border-radius:16px;box-shadow:var(--shadow-lg);width:560px;max-width:90vw;max-height:85vh;overflow-y:auto;animation:modalIn .25s ease}
@keyframes modalIn{from{opacity:0;transform:scale(.96) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-header{padding:24px 28px 0}
.modal-title{font-size:20px;font-weight:600;letter-spacing:-.3px}
.modal-subtitle{font-size:13.5px;color:var(--text-secondary);margin-top:4px}
.modal-body{padding:20px 28px}
.modal-footer{padding:16px 28px 24px;display:flex;gap:10px;justify-content:flex-start}

.compliance-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.compliance-header{padding:14px 18px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
.compliance-score{font-size:13px;font-weight:600;padding:3px 12px;border-radius:20px}
.score-pass{background:var(--success-light);color:var(--success)}
.score-warn{background:var(--warning-light);color:var(--warning)}
.score-fail{background:var(--danger-light);color:var(--danger)}
.compliance-item{padding:10px 18px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);font-size:13px}
.compliance-item:last-child{border-bottom:none}
.ci{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}
.ci-pass{background:var(--success-light);color:var(--success)}
.ci-warn{background:var(--warning-light);color:var(--warning)}
.ci-fail{background:var(--danger-light);color:var(--danger)}

.audit-item{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);font-size:13px}
.audit-item:last-child{border-bottom:none}
.audit-time{color:var(--text-tertiary);font-size:11.5px;white-space:nowrap;min-width:60px}
.audit-dot{width:8px;height:8px;border-radius:50%;background:var(--border-strong);margin-top:5px;flex-shrink:0}
.audit-field{font-weight:600;color:var(--text-primary)}

.kanban-board{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px}
.kanban-col{background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:16px;min-height:180px}
.kanban-col-title{font-size:12.5px;font-weight:600;color:var(--text-secondary);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.kanban-count{background:var(--border);color:var(--text-secondary);font-size:10px;padding:1px 7px;border-radius:10px}
.kanban-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;margin-bottom:10px;cursor:pointer;transition:var(--transition)}
.kanban-card:hover{box-shadow:var(--shadow-md)}
.kanban-role{font-size:12px;font-weight:600;color:var(--accent);margin-bottom:4px}
.kanban-desc{font-size:13px;color:var(--text-secondary);margin-bottom:8px}

.boq-table{width:100%;border-collapse:collapse}
.boq-table th{text-align:right;padding:10px 12px;font-size:11.5px;font-weight:600;color:var(--text-tertiary);background:var(--bg);border-bottom:1px solid var(--border)}
.boq-table td{padding:6px 8px;border-bottom:1px solid var(--border)}
.boq-table input{width:100%;padding:7px 10px;border:1px solid var(--border);border-radius:var(--radius-xs);font-size:13px;font-family:inherit;outline:none;transition:var(--transition)}
.boq-table input:focus{border-color:var(--accent);box-shadow:0 0 0 2px rgba(0,113,227,.1)}

.eval-row{display:grid;grid-template-columns:1fr 100px 80px;gap:10px;margin-bottom:8px;align-items:center}
.eval-total{font-size:14px;font-weight:600;padding:10px 0;display:flex;justify-content:space-between;border-top:2px solid var(--text-primary);margin-top:8px}
.eval-error{color:var(--danger);font-size:12.5px;font-weight:500;margin-top:6px}

.attachment-item{display:flex;align-items:center;gap:12px;padding:12px 16px;border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:8px;background:var(--surface)}
.attachment-icon{width:36px;height:36px;background:var(--bg);border-radius:var(--radius-xs);display:flex;align-items:center;justify-content:center;color:var(--text-tertiary);font-size:16px}
.attachment-name{flex:1;font-size:13.5px;font-weight:500}
.attachment-size{font-size:12px;color:var(--text-tertiary)}

.type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
.type-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;cursor:pointer;transition:var(--transition);text-align:center}
.type-card:hover{border-color:var(--border-strong)}
.type-card.selected{border-color:var(--accent);background:var(--accent-light)}
.type-icon{font-size:28px;margin-bottom:8px}
.type-name{font-size:14px;font-weight:600}
.type-desc{font-size:12px;color:var(--text-tertiary);margin-top:2px}

.toast-container{position:fixed;bottom:24px;left:24px;z-index:300;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--text-primary);color:#fff;padding:12px 20px;border-radius:var(--radius-sm);font-size:13.5px;box-shadow:var(--shadow-lg);animation:toastIn .3s ease,toastOut .3s ease 2.7s forwards;display:flex;align-items:center;gap:8px}
@keyframes toastIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes toastOut{from{opacity:1}to{opacity:0;transform:translateY(10px)}}

.toggle-wrap{display:flex;align-items:center;gap:8px}
.toggle{width:40px;height:22px;background:var(--border-strong);border-radius:11px;position:relative;cursor:pointer;transition:var(--transition)}
.toggle.on{background:var(--accent)}
.toggle::after{content:'';width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:2px;right:2px;transition:var(--transition);box-shadow:0 1px 3px rgba(0,0,0,.15)}
.toggle.on::after{right:20px}

.step-content{display:none}.step-content.active{display:block}
.step-content-title{font-size:20px;font-weight:600;letter-spacing:-.3px;margin-bottom:6px}
.step-content-desc{font-size:13.5px;color:var(--text-secondary);margin-bottom:24px}

.deliverable-item{border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-bottom:10px;background:var(--surface);position:relative}
.deliverable-num{position:absolute;top:16px;left:16px;width:24px;height:24px;background:var(--bg);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;color:var(--text-tertiary)}
.del-remove{position:absolute;top:12px;left:46px;background:none;border:none;color:var(--text-tertiary);cursor:pointer;font-size:16px;padding:2px;transition:var(--transition)}
.del-remove:hover{color:var(--danger)}

.spec-block{border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:12px;overflow:hidden}
.spec-block-header{padding:12px 16px;background:var(--bg);font-size:13.5px;font-weight:600;display:flex;align-items:center;gap:8px;cursor:pointer;transition:var(--transition)}
.spec-block-header:hover{background:var(--surface-hover)}
.spec-block-body{padding:16px;display:none}
.spec-block.open .spec-block-body{display:block}
.spec-block-arrow{transition:var(--transition);font-size:12px}
.spec-block.open .spec-block-arrow{transform:rotate(90deg)}

.checklist-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);font-size:13.5px}
.checklist-item:last-child{border-bottom:none}
.checklist-check{width:20px;height:20px;border:1.5px solid var(--border-strong);border-radius:5px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);color:transparent;font-size:12px;flex-shrink:0}
.checklist-check.checked{background:var(--success);border-color:var(--success);color:#fff}

::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-strong);border-radius:3px}
:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
</style>
</head>
<body>

<header>
  <div class="logo"><div class="logo-icon">أ</div>منصة كراسات الشروط والمواصفات</div>
  <div class="header-left">
    <button class="header-btn" title="بحث">&#128269;</button>
    <button class="header-btn" title="إشعارات" style="position:relative">&#128276;<span style="position:absolute;top:4px;right:4px;width:7px;height:7px;background:var(--danger);border-radius:50%;border:1.5px solid #fff"></span></button>
    <div class="user-badge"><div class="user-avatar">خ</div><span>خالد — مسؤول المشتريات</span></div>
  </div>
</header>

<aside><nav>
  <div class="nav-section">
    <div class="nav-section-title">الرئيسية</div>
    <div class="nav-item active" onclick="navigate('dashboard')"><span class="nav-icon">&#128202;</span>لوحة المعلومات</div>
    <div class="nav-item" onclick="openWizard()"><span class="nav-icon">&#10024;</span>منافسة جديدة</div>
  </div>
  <div class="nav-section">
    <div class="nav-section-title">إدارة المنافسات</div>
    <div class="nav-item" onclick="navigate('builder')"><span class="nav-icon">&#128221;</span>المُحرر<span class="nav-badge">2</span></div>
    <div class="nav-item" onclick="navigate('approvals')"><span class="nav-icon">&#9989;</span>المراجعة والاعتمادات</div>
    <div class="nav-item" onclick="navigate('publish')"><span class="nav-icon">&#128228;</span>النشر والتصدير</div>
  </div>
  <div class="nav-section">
    <div class="nav-section-title">النظام</div>
    <div class="nav-item" onclick="navigate('audit')"><span class="nav-icon">&#128203;</span>سجل المراجعة</div>
    <div class="nav-item" onclick="navigate('compliance')"><span class="nav-icon">&#128737;</span>بوابة الامتثال</div>
  </div>
</nav></aside>

<main>

<!-- DASHBOARD -->
<div class="view active" id="view-dashboard">
  <div class="page-title">لوحة المعلومات</div>
  <div class="page-subtitle">أمانة منطقة الرياض — إدارة المشتريات والمنافسات</div>
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-label">إجمالي المنافسات</div><div class="stat-value">24</div><div class="stat-change">&#8593; 3 هذا الشهر</div></div>
    <div class="stat-card"><div class="stat-label">قيد الإعداد</div><div class="stat-value" style="color:var(--warning)">8</div><div class="stat-change" style="color:var(--text-tertiary)">مسودة</div></div>
    <div class="stat-card"><div class="stat-label">بانتظار الاعتماد</div><div class="stat-value" style="color:var(--accent)">5</div><div class="stat-change" style="color:var(--text-tertiary)">قيد المراجعة</div></div>
    <div class="stat-card"><div class="stat-label">منشورة</div><div class="stat-value" style="color:var(--success)">11</div><div class="stat-change">&#8593; 2 هذا الأسبوع</div></div>
  </div>
  <div class="section-header"><div class="section-title">أحدث المنافسات</div><button class="btn btn-outline btn-sm" onclick="openWizard()">+ منافسة جديدة</button></div>
  <div class="data-table"><table><thead><tr><th>رقم المنافسة</th><th>عنوان المنافسة</th><th>النوع</th><th>الحالة</th><th>التاريخ</th><th></th></tr></thead><tbody>
    <tr><td style="font-weight:600">RFP-2026-001</td><td>مشروع رفع مستوى السلامة المرورية في الشوارع الرئيسية بحي المهدية</td><td>طرق</td><td><span class="status-chip status-review">قيد المراجعة</span></td><td style="color:var(--text-tertiary)">2026/02/18</td><td><button class="btn btn-ghost btn-sm" onclick="navigate('builder')">فتح</button></td></tr>
    <tr><td style="font-weight:600">RFP-2026-002</td><td>مشروع تطوير نظام إدارة المرافق الذكية</td><td>تقنية</td><td><span class="status-chip status-draft">مسودة</span></td><td style="color:var(--text-tertiary)">2026/02/15</td><td><button class="btn btn-ghost btn-sm" onclick="navigate('builder')">فتح</button></td></tr>
    <tr><td style="font-weight:600">RFP-2025-089</td><td>دراسة تقييم البنية التحتية لشبكات الصرف الصحي</td><td>استشارات</td><td><span class="status-chip status-approved">معتمد</span></td><td style="color:var(--text-tertiary)">2026/01/28</td><td><button class="btn btn-ghost btn-sm">فتح</button></td></tr>
    <tr><td style="font-weight:600">RFP-2025-088</td><td>مشروع تحسين الإنارة في الأحياء السكنية — المرحلة الثانية</td><td>طرق</td><td><span class="status-chip status-published">منشور</span></td><td style="color:var(--text-tertiary)">2026/01/10</td><td><button class="btn btn-ghost btn-sm">فتح</button></td></tr>
  </tbody></table></div>
</div>

<!-- BUILDER -->
<div class="view view-builder" id="view-builder"><div class="builder-container">
  <div class="builder-main">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div><div style="font-size:11px;color:var(--text-tertiary);font-weight:500;margin-bottom:2px">RFP-2026-001</div><div style="font-size:18px;font-weight:600" id="builder-title">مشروع رفع مستوى السلامة المرورية في الشوارع الرئيسية بحي المهدية</div></div>
      <div style="display:flex;gap:8px"><button class="btn btn-outline btn-sm" onclick="navigate('compliance')">&#128737; الامتثال</button><button class="btn btn-outline btn-sm" onclick="navigate('audit')">&#128203; السجل</button></div>
    </div>
    <div style="font-size:11px;font-weight:600;color:var(--text-tertiary);letter-spacing:.3px;margin-bottom:4px">خطوات إعداد الكراسة</div>
    <div class="stepper" id="stepper">
      <div class="step-item active" onclick="goStep(0)"><span class="step-num">1</span>نظرة عامة</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(1)"><span class="step-num">2</span>نطاق العمل</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(2)"><span class="step-num">3</span>المواصفات</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(3)"><span class="step-num">4</span>التقييم</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(4)"><span class="step-num">5</span>التجاري</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(5)"><span class="step-num">6</span>المحتوى المحلي</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(6)"><span class="step-num">7</span>المرفقات</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(7)"><span class="step-num">8</span>المراجعة</div><div class="step-divider"></div>
      <div class="step-item" onclick="goStep(8)"><span class="step-num">9</span>النشر</div>
    </div>

    <!-- STEP 0 -->
    <div class="step-content active" id="step-0">
      <div class="step-content-title">خطوة 1: بيانات المنافسة (القسم الأول: مقدمة)</div>
      <div class="step-content-desc">المعلومات الأساسية والتعريفات</div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">معلومات المنافسة</div>
        <div class="form-row"><div class="form-group"><label class="form-label">عنوان المنافسة *</label><input class="form-input" id="f-title" value="مشروع رفع مستوى السلامة المرورية في الشوارع الرئيسية بحي المهدية" oninput="updateField('title',this.value)"></div>
        <div class="form-group"><label class="form-label">رقم المنافسة</label><input class="form-input" id="f-refnum" value="RFP-2026-001" oninput="updateField('refNum',this.value)"></div></div>
        <div class="form-row"><div class="form-group"><label class="form-label">الجهة الحكومية *</label><input class="form-input" id="f-entity" value="أمانة منطقة الرياض" oninput="updateField('entity',this.value)"></div>
        <div class="form-group"><label class="form-label">الإدارة المختصة</label><input class="form-input" id="f-dept" value="الإدارة العامة للمشاريع" oninput="updateField('department',this.value)"></div></div>
        <div class="form-row"><div class="form-group"><label class="form-label">نوع المشروع</label><select class="form-select" id="f-type" onchange="updateField('projectType',this.value)"><option value="roads" selected>طرق وبنية تحتية</option><option value="it">تقنية معلومات</option><option value="consulting">استشارات</option></select></div>
        <div class="form-group"><label class="form-label">قيمة وثائق المنافسة (ريال)</label><input class="form-input" id="f-docfee" value="5,000" oninput="updateField('docFee',this.value)"></div></div>
      </div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">المواعيد الرئيسية</div>
        <div class="form-row-3"><div class="form-group"><label class="form-label">تاريخ طرح الكراسة *</label><input class="form-input" type="date" id="f-pubdate" value="2026-03-01" oninput="updateField('publishDate',this.value)"></div>
        <div class="form-group"><label class="form-label">آخر موعد لاستلام العروض</label><input class="form-input" type="date" id="f-deadline" value="2026-04-15" oninput="updateField('deadline',this.value)"></div>
        <div class="form-group"><label class="form-label">مدة سريان العروض (يوم) *</label><input class="form-input" type="number" id="f-validity" value="90" oninput="updateField('validityDays',this.value)"></div></div>
        <div class="form-row-3"><div class="form-group"><label class="form-label">مدة تنفيذ المشروع (شهر)</label><input class="form-input" type="number" id="f-duration" value="18" oninput="updateField('durationMonths',this.value)"></div>
        <div class="form-group"><label class="form-label">الضمان الابتدائي (%) *</label><input class="form-input" type="number" id="f-initg" value="2" oninput="updateField('initialGuarantee',this.value)"><div class="form-hint">نسبة من قيمة العرض المالي</div></div>
        <div class="form-group"><label class="form-label">الضمان النهائي (%)</label><input class="form-input" type="number" id="f-finalg" value="5" oninput="updateField('finalGuarantee',this.value)"></div></div>
      </div>
      <div class="card"><div class="card-title">وصف المنافسة</div><div class="form-group"><label class="form-label">وصف مختصر</label><textarea class="form-textarea" id="f-desc" rows="4" oninput="updateField('description',this.value)">تتضمن هذه المنافسة تنفيذ أعمال رفع مستوى السلامة المرورية في الشوارع الرئيسية بحي المهدية بمدينة الرياض، وتشمل تركيب إشارات مرورية ضوئية، وعلامات إرشادية، وتنفيذ مطبات صناعية، وتحسين الإنارة، ودهان خطوط الطرق وممرات المشاة.</textarea></div></div>
      <div style="margin-top:20px"><button class="btn btn-primary" onclick="goStep(1)">التالي: نطاق العمل &#8592;</button></div>
    </div>

    <!-- STEP 1 -->
    <div class="step-content" id="step-1">
      <div class="step-content-title">خطوة 2: نطاق العمل والمخرجات (القسم السابع)</div>
      <div class="step-content-desc">تحديد مخرجات المشروع ومعايير القبول</div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">المخرجات</div><div id="deliverables-list"></div><button class="btn btn-outline btn-sm" onclick="addDeliverable()" style="margin-top:8px">+ إضافة مخرج</button></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(0)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(2)">التالي: المواصفات &#8592;</button></div>
    </div>

    <!-- STEP 2 -->
    <div class="step-content" id="step-2">
      <div class="step-content-title">خطوة 3: المواصفات (القسم الثامن)</div>
      <div class="step-content-desc">المواصفات الفنية التفصيلية</div>
      <div id="specs-container"></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(1)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(3)">التالي: التقييم &#8592;</button></div>
    </div>

    <!-- STEP 3 -->
    <div class="step-content" id="step-3">
      <div class="step-content-title">خطوة 4: تقييم العروض (القسم الخامس)</div>
      <div class="step-content-desc">معايير تقييم العروض</div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">معايير التقييم الفني</div><div id="eval-criteria-list"></div><button class="btn btn-outline btn-sm" onclick="addEvalCriteria()" style="margin-top:8px">+ إضافة معيار</button>
        <div class="eval-total" id="eval-total"><span>الإجمالي</span><span id="eval-total-val">0%</span></div><div class="eval-error" id="eval-error" style="display:none"></div></div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">إعدادات التقييم</div>
        <div class="form-row-3"><div class="form-group"><label class="form-label">وزن التقييم الفني (%)</label><input class="form-input" type="number" id="f-techw" value="70" oninput="updateField('techWeight',this.value)"></div>
        <div class="form-group"><label class="form-label">وزن التقييم المالي (%)</label><input class="form-input" type="number" id="f-finw" value="30" oninput="updateField('finWeight',this.value)"></div>
        <div class="form-group"><label class="form-label">حد أدنى فني (%)</label><input class="form-input" type="number" id="f-mint" value="70" oninput="updateField('minTechScore',this.value)"></div></div>
        <div class="form-group"><div class="toggle-wrap"><div class="toggle" id="toggle-lc" onclick="toggleLC()"></div><span style="font-size:13px">تضمين المحتوى المحلي كمعيار تقييم</span></div></div></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(2)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(4)">التالي: التجاري &#8592;</button></div>
    </div>

    <!-- STEP 4 -->
    <div class="step-content" id="step-4">
      <div class="step-content-title">خطوة 5: جدول الكميات والأسعار (ضمن القسم السابع/ملحق حسب القالب)</div>
      <div class="step-content-desc">أسعار الوحدات تُترك فارغة للمتنافسين</div>
      <div class="card" style="margin-bottom:16px;overflow-x:auto"><div class="card-title">جدول الكميات</div>
        <table class="boq-table"><thead><tr><th style="width:40px">م</th><th>وصف البند</th><th style="width:100px">الوحدة</th><th style="width:80px">الكمية</th><th style="width:100px">سعر الوحدة</th><th style="width:36px"></th></tr></thead><tbody id="boq-body"></tbody></table>
        <button class="btn btn-outline btn-sm" onclick="addBOQRow()" style="margin-top:12px">+ إضافة بند</button></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(3)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(5)">التالي: المحتوى المحلي &#8592;</button></div>
    </div>

    <!-- STEP 5 -->
    <div class="step-content" id="step-5">
      <div class="step-content-title">خطوة 6: المحتوى المحلي (القسم التاسع) + الشروط الخاصة (القسم العاشر)</div>
      <div class="step-content-desc">متطلبات المحتوى المحلي والشروط الخاصة</div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">متطلبات المحتوى المحلي</div>
        <div class="form-row"><div class="form-group"><label class="form-label">النسبة المستهدفة (%)</label><input class="form-input" type="number" id="f-lpct" value="40" oninput="updateField('localContentPct',this.value)"></div>
        <div class="form-group"><label class="form-label">القائمة</label><select class="form-select"><option value="mandatory">إلزامية</option><option value="preferred">تفضيلية</option></select></div></div>
        <div class="form-group"><label class="form-label">ملاحظات</label><textarea class="form-textarea" rows="3" oninput="updateField('localNotes',this.value)">يلتزم المتنافس بتحقيق نسبة المحتوى المحلي وفقاً لمتطلبات هيئة المحتوى المحلي وشراء الحكومي.</textarea></div></div>
      <div class="card"><div class="card-title">الشروط الخاصة</div><div class="form-group"><textarea class="form-textarea" rows="4" oninput="updateField('specialConditions',this.value)">1. يجب على المقاول الالتزام بمعايير السلامة المرورية أثناء التنفيذ.
2. يلتزم المقاول بتقديم خطة إدارة الجودة وخطة الأمن والسلامة.
3. لا يجوز التنازل عن العقد أو إسناده من الباطن إلا بموافقة كتابية.</textarea></div></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(4)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(6)">التالي: المرفقات &#8592;</button></div>
    </div>

    <!-- STEP 6 -->
    <div class="step-content" id="step-6">
      <div class="step-content-title">خطوة 7: الملاحق والمرفقات (القسم الثاني عشر)</div>
      <div class="step-content-desc">المستندات المرفقة بكراسة الشروط</div>
      <div class="card"><div class="card-title">المرفقات</div><div id="attachments-list"></div><button class="btn btn-outline btn-sm" onclick="addAttachment()" style="margin-top:12px">+ إضافة مرفق</button></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(5)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(7)">التالي: المراجعة &#8592;</button></div>
    </div>

    <!-- STEP 7 -->
    <div class="step-content" id="step-7">
      <div class="step-content-title">خطوة 8: المراجعة والاعتمادات</div>
      <div class="step-content-desc">مراجعة واعتماد الكراسة</div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">&#128737; بوابة الامتثال</div><div id="inline-compliance"></div></div>
      <div class="card"><div class="card-title">مسار الاعتمادات</div><div class="kanban-board" id="inline-kanban"></div></div>
      <div style="margin-top:20px;display:flex;gap:10px"><button class="btn btn-outline" onclick="goStep(6)">&#8594; السابق</button><button class="btn btn-primary" onclick="goStep(8)">التالي: النشر &#8592;</button></div>
    </div>

    <!-- STEP 8 -->
    <div class="step-content" id="step-8">
      <div class="step-content-title">خطوة 9: النشر والتصدير</div>
      <div class="step-content-desc">تصدير الكراسة ونشرها على منصة اعتماد</div>
      <div class="card" style="margin-bottom:16px"><div class="card-title">تصدير المستند</div><div style="display:flex;gap:12px;flex-wrap:wrap"><button class="btn btn-primary" onclick="mockExport()">&#128196; تصدير PDF</button><button class="btn btn-accent" onclick="showEtimad()">&#127963; حزمة اعتماد</button></div></div>
      <div class="card"><div class="card-title">حالة النشر</div><div style="display:flex;align-items:center;gap:12px;padding:16px 0"><div style="width:48px;height:48px;border-radius:50%;background:var(--success-light);display:flex;align-items:center;justify-content:center;font-size:22px">&#9989;</div><div><div style="font-size:15px;font-weight:600">جاهز للنشر</div><div style="font-size:13px;color:var(--text-secondary)">جميع الحقول المطلوبة مكتملة</div></div></div></div>
      <div style="margin-top:20px"><button class="btn btn-outline" onclick="goStep(7)">&#8594; السابق</button></div>
    </div>
  </div>

  <div class="builder-preview">
    <div class="preview-header"><span>أقسام كراسة الشروط والمواصفات</span><span style="font-size:11px;color:var(--text-tertiary)">&#9679; مباشر</span></div>
    <div class="preview-content" id="preview-content"></div>
  </div>
</div></div>

<!-- APPROVALS -->
<div class="view" id="view-approvals"><div class="page-title">المراجعة والاعتمادات</div><div class="page-subtitle">مسار اعتماد كراسة الشروط والمواصفات</div><div class="kanban-board" id="approvals-kanban"></div></div>

<!-- PUBLISH -->
<div class="view" id="view-publish"><div class="page-title">النشر والتصدير</div><div class="page-subtitle">تصدير الكراسة ونشرها</div>
  <div class="card" style="margin-bottom:16px"><div class="card-title">إجراءات التصدير</div><div style="display:flex;gap:12px;flex-wrap:wrap"><button class="btn btn-primary" onclick="mockExport()">&#128196; تصدير PDF</button><button class="btn btn-accent" onclick="showEtimad()">&#127963; حزمة اعتماد</button></div></div>
  <div class="card"><div class="card-title">سجل التصدير</div><div style="color:var(--text-tertiary);font-size:13px;padding:20px 0;text-align:center">لم يتم إجراء أي تصدير بعد</div></div></div>

<!-- AUDIT -->
<div class="view" id="view-audit"><div class="page-title">سجل المراجعة</div><div class="page-subtitle">جميع التغييرات والإجراءات</div><div class="card"><div id="audit-log-list"></div></div></div>

<!-- COMPLIANCE -->
<div class="view" id="view-compliance"><div class="page-title">بوابة الامتثال</div><div class="page-subtitle">التحقق من اكتمال متطلبات كراسة الشروط</div><div class="compliance-panel" id="compliance-panel"></div></div>

</main>

<!-- MODALS -->
<div class="modal-overlay" id="wizard-modal"><div class="modal">
  <div class="modal-header"><div class="modal-title">إنشاء منافسة جديدة</div><div class="modal-subtitle">اختر نوع المشروع</div></div>
  <div class="modal-body">
    <div class="form-group"><label class="form-label">عنوان المنافسة</label><input class="form-input" id="wiz-title" placeholder="أدخل عنوان المنافسة..."></div>
    <div class="form-group"><label class="form-label">نوع المشروع</label><div class="type-grid">
      <div class="type-card selected" onclick="selType(this,'roads')"><div class="type-icon">&#128739;</div><div class="type-name">طرق وبنية تحتية</div><div class="type-desc">مشاريع الطرق والإنارة</div></div>
      <div class="type-card" onclick="selType(this,'it')"><div class="type-icon">&#128187;</div><div class="type-name">تقنية معلومات</div><div class="type-desc">أنظمة تقنية</div></div>
      <div class="type-card" onclick="selType(this,'consulting')"><div class="type-icon">&#128200;</div><div class="type-name">استشارات</div><div class="type-desc">دراسات وأعمال استشارية</div></div>
    </div></div>
    <div class="form-row"><div class="form-group"><label class="form-label">الجهة الحكومية</label><input class="form-input" id="wiz-entity" value="أمانة منطقة الرياض"></div>
    <div class="form-group"><label class="form-label">الإدارة</label><input class="form-input" id="wiz-dept" placeholder="الإدارة المختصة..."></div></div>
  </div>
  <div class="modal-footer"><button class="btn btn-primary" onclick="createFromWizard()">إنشاء المنافسة</button><button class="btn btn-outline" onclick="closeModal('wizard-modal')">إلغاء</button></div>
</div></div>

<div class="modal-overlay" id="export-modal"><div class="modal">
  <div class="modal-header"><div class="modal-title">تصدير كراسة الشروط</div><div class="modal-subtitle">تم إنشاء ملف التصدير بنجاح</div></div>
  <div class="modal-body"><div style="text-align:center;padding:20px 0"><div style="font-size:48px;margin-bottom:12px">&#128196;</div><div style="font-size:15px;font-weight:600">كراسة الشروط والمواصفات</div><div style="font-size:13px;color:var(--text-secondary)">تصدير تجريبي — ملف نصي</div></div></div>
  <div class="modal-footer"><button class="btn btn-primary" onclick="downloadExport()">&#11015; تحميل الملف</button><button class="btn btn-outline" onclick="closeModal('export-modal')">إغلاق</button></div>
</div></div>

<div class="modal-overlay" id="etimad-modal"><div class="modal">
  <div class="modal-header"><div class="modal-title">&#127963; حزمة منصة اعتماد</div><div class="modal-subtitle">قائمة التحقق لرفع المنافسة على البوابة الإلكترونية</div></div>
  <div class="modal-body"><div id="etimad-checklist"></div></div>
  <div class="modal-footer"><button class="btn btn-accent" onclick="toast('تم تجهيز الحزمة');closeModal('etimad-modal')">تأكيد وتجهيز</button><button class="btn btn-outline" onclick="closeModal('etimad-modal')">إغلاق</button></div>
</div></div>

<div class="toast-container" id="toast-container"></div>

<script>
const rfp={title:'مشروع رفع مستوى السلامة المرورية في الشوارع الرئيسية بحي المهدية',refNum:'RFP-2026-001',entity:'أمانة منطقة الرياض',department:'الإدارة العامة للمشاريع',projectType:'roads',docFee:'5,000',publishDate:'2026-03-01',deadline:'2026-04-15',validityDays:'90',durationMonths:'18',initialGuarantee:'2',finalGuarantee:'5',description:'تتضمن هذه المنافسة تنفيذ أعمال رفع مستوى السلامة المرورية في الشوارع الرئيسية بحي المهدية بمدينة الرياض، وتشمل تركيب إشارات مرورية ضوئية، وعلامات إرشادية، وتنفيذ مطبات صناعية، وتحسين الإنارة، ودهان خطوط الطرق وممرات المشاة.',techWeight:'70',finWeight:'30',minTechScore:'70',includeLC:false,localContentPct:'40',localNotes:'يلتزم المتنافس بتحقيق نسبة المحتوى المحلي وفقاً لمتطلبات هيئة المحتوى المحلي وشراء الحكومي.',specialConditions:'1. يجب على المقاول الالتزام بمعايير السلامة المرورية أثناء التنفيذ.\n2. يلتزم المقاول بتقديم خطة إدارة الجودة وخطة الأمن والسلامة.\n3. لا يجوز التنازل عن العقد إلا بموافقة كتابية.',deliverables:[],evalCriteria:[],boqItems:[],attachments:[],specs:[]};
let curStep=0;const auditLog=[];
const approvalItems=[
  {role:'طالب الجهة (صاحب الطلب)',desc:'مراجعة نطاق العمل والمخرجات',status:'approved'},
  {role:'مالك فني',desc:'مراجعة المواصفات الفنية والتقييم',status:'review'},
  {role:'قانوني/التزام',desc:'مراجعة الشروط العامة والخاصة',status:'review'},
  {role:'مالية',desc:'مراجعة جدول الكميات والأسعار',status:'pending'},
  {role:'مسؤول المشتريات',desc:'الاعتماد النهائي للكراسة',status:'pending'},
  {role:'مدير النظام',desc:'مراجعة الامتثال التقني',status:'approved'}
];

function navigate(v){document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));document.getElementById('view-'+v).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));const m={dashboard:0,builder:2,approvals:3,publish:4,audit:5,compliance:6};if(m[v]!==undefined)document.querySelectorAll('.nav-item')[m[v]].classList.add('active');if(v==='approvals')renderApprovals();if(v==='audit')renderAuditLog();if(v==='compliance')renderCompPanel();if(v==='builder')updatePreview();}

function goStep(i){curStep=i;document.querySelectorAll('.step-item').forEach((s,j)=>{s.classList.remove('active','completed');if(j===i)s.classList.add('active');else if(j<i)s.classList.add('completed');});document.querySelectorAll('.step-content').forEach((c,j)=>c.classList.toggle('active',j===i));if(i===7){renderInlineComp();renderInlineKanban();}updatePreview();}

function updateField(k,v){const o=rfp[k];rfp[k]=v;addAudit('تحديث',k,o,v);updatePreview();}

function initDeliverables(){rfp.deliverables=[{name:'تركيب إشارات مرورية ضوئية',criteria:'تركيب وتشغيل 15 إشارة ضوئية وفق المواصفات المعتمدة',duration:'3 أشهر'},{name:'تركيب علامات إرشادية ولوحات تحذيرية',criteria:'تركيب 200 لوحة إرشادية مطابقة للمواصفات',duration:'2 أشهر'},{name:'تنفيذ مطبات صناعية وخطوط أرضية',criteria:'تنفيذ 30 مطب صناعي ودهان 5000 متر طولي',duration:'4 أشهر'}];renderDel();}

function renderDel(){const l=document.getElementById('deliverables-list');l.innerHTML=rfp.deliverables.map((d,i)=>'<div class="deliverable-item"><span class="deliverable-num">'+(i+1)+'</span><button class="del-remove" onclick="rmDel('+i+')">&#10005;</button><div class="form-group" style="margin-bottom:10px"><label class="form-label">اسم المخرج</label><input class="form-input" value="'+d.name+'" oninput="rfp.deliverables['+i+'].name=this.value;updatePreview()"></div><div class="form-row"><div class="form-group" style="margin-bottom:0"><label class="form-label">معايير القبول</label><input class="form-input" value="'+d.criteria+'" oninput="rfp.deliverables['+i+'].criteria=this.value;updatePreview()"></div><div class="form-group" style="margin-bottom:0"><label class="form-label">المدة</label><input class="form-input" value="'+d.duration+'" oninput="rfp.deliverables['+i+'].duration=this.value;updatePreview()"></div></div></div>').join('');}

function addDeliverable(){rfp.deliverables.push({name:'',criteria:'',duration:''});renderDel();addAudit('إضافة','مخرج جديد','','');updatePreview();}
function rmDel(i){rfp.deliverables.splice(i,1);renderDel();updatePreview();}

function initSpecs(){const d={roads:[{id:'materials',title:'المواد',content:'يجب أن تكون جميع المواد مطابقة للمواصفات القياسية السعودية (SASO) والمواصفات الأمريكية (AASHTO).'},{id:'equipment',title:'المعدات',content:'يلتزم المقاول بتوفير المعدات اللازمة لتنفيذ الأعمال وفق الجدول الزمني.'},{id:'execution',title:'كيفية تنفيذ الأعمال والخدمات',content:'يتم التنفيذ وفق خطة العمل المعتمدة مع الالتزام بالجدول الزمني ومعايير الجودة.'},{id:'quality',title:'مواصفات الجودة',content:'يلتزم المقاول بتطبيق نظام إدارة الجودة ISO 9001.'},{id:'safety',title:'مواصفات السلامة',content:'يلتزم المقاول بتوفير خطة الأمن والسلامة وفق اشتراطات الدفاع المدني.'}],it:[{id:'func',title:'المتطلبات الوظيفية',content:''},{id:'nonfunc',title:'المتطلبات غير الوظيفية',content:''},{id:'integ',title:'متطلبات التكامل',content:''},{id:'sec',title:'متطلبات أمن المعلومات',content:''}],consulting:[{id:'method',title:'المنهجية',content:''},{id:'team',title:'فريق العمل',content:''},{id:'reports',title:'التقارير والمخرجات',content:''}]};rfp.specs=d[rfp.projectType]||d.roads;renderSpecs();}

function renderSpecs(){document.getElementById('specs-container').innerHTML=rfp.specs.map((s,i)=>'<div class="spec-block'+(i===0?' open':'')+'" id="spec-'+s.id+'"><div class="spec-block-header" onclick="document.getElementById(\'spec-'+s.id+'\').classList.toggle(\'open\')"><span class="spec-block-arrow">&#9664;</span>'+s.title+'</div><div class="spec-block-body"><textarea class="form-textarea" rows="3" oninput="rfp.specs['+i+'].content=this.value;updatePreview()">'+s.content+'</textarea></div></div>').join('');}

function initEval(){rfp.evalCriteria=[{name:'الخبرة والمشاريع المماثلة',weight:25},{name:'المنهجية وخطة العمل',weight:25},{name:'فريق العمل والكوادر الفنية',weight:20},{name:'الجدول الزمني',weight:15},{name:'خطة إدارة الجودة والسلامة',weight:15}];renderEval();}

function renderEval(){document.getElementById('eval-criteria-list').innerHTML=rfp.evalCriteria.map((c,i)=>'<div class="eval-row"><input class="form-input" value="'+c.name+'" oninput="rfp.evalCriteria['+i+'].name=this.value;updatePreview()" placeholder="اسم المعيار"><input class="form-input" type="number" value="'+c.weight+'" oninput="rfp.evalCriteria['+i+'].weight=Number(this.value);calcEval();updatePreview()" style="text-align:center"><button class="btn-icon" onclick="rfp.evalCriteria.splice('+i+',1);renderEval();updatePreview()">&#10005;</button></div>').join('');calcEval();}

function addEvalCriteria(){rfp.evalCriteria.push({name:'',weight:0});renderEval();}

function calcEval(){const t=rfp.evalCriteria.reduce((s,c)=>s+(c.weight||0),0);document.getElementById('eval-total-val').textContent=t+'%';const e=document.getElementById('eval-error');if(t!==100){e.style.display='block';e.textContent=t>100?'&#9888; الإجمالي يتجاوز 100% ('+t+'%)':'&#9888; الإجمالي أقل من 100% ('+t+'%)';document.getElementById('eval-total').style.borderColor='var(--danger)';}else{e.style.display='none';document.getElementById('eval-total').style.borderColor='var(--success)';}}

function initBOQ(){rfp.boqItems=[{desc:'توريد وتركيب إشارات مرورية ضوئية LED',unit:'إشارة',qty:15},{desc:'توريد وتركيب لوحات إرشادية عاكسة',unit:'لوحة',qty:200},{desc:'تنفيذ مطبات صناعية مطاطية',unit:'مطب',qty:30},{desc:'دهان خطوط أرضية حرارية',unit:'م.ط',qty:5000},{desc:'توريد وتركيب أعمدة إنارة LED',unit:'عمود',qty:45}];renderBOQ();}

function renderBOQ(){document.getElementById('boq-body').innerHTML=rfp.boqItems.map((b,i)=>'<tr><td style="text-align:center;color:var(--text-tertiary);font-size:12px">'+(i+1)+'</td><td><input value="'+b.desc+'" oninput="rfp.boqItems['+i+'].desc=this.value;updatePreview()"></td><td><input value="'+b.unit+'" oninput="rfp.boqItems['+i+'].unit=this.value;updatePreview()"></td><td><input type="number" value="'+b.qty+'" oninput="rfp.boqItems['+i+'].qty=this.value;updatePreview()"></td><td><input disabled placeholder="يُحدد من المتنافس" style="background:#fafafa;color:var(--text-tertiary);font-size:12px"></td><td><button class="btn-icon" style="border:none" onclick="rfp.boqItems.splice('+i+',1);renderBOQ();updatePreview()">&#10005;</button></td></tr>').join('');}

function addBOQRow(){rfp.boqItems.push({desc:'',unit:'',qty:0});renderBOQ();addAudit('إضافة','بند جدول كميات','','');}

function initAttach(){rfp.attachments=[{name:'نموذج خطاب الضمان الابتدائي.pdf',size:'120 KB'},{name:'نموذج العرض المالي.xlsx',size:'85 KB'},{name:'المخططات الهندسية — حي المهدية.dwg',size:'2.4 MB'}];renderAttach();}

function renderAttach(){document.getElementById('attachments-list').innerHTML=rfp.attachments.map((a,i)=>'<div class="attachment-item"><div class="attachment-icon">&#128206;</div><div class="attachment-name">'+a.name+'</div><div class="attachment-size">'+a.size+'</div><button class="btn-icon" onclick="rfp.attachments.splice('+i+',1);renderAttach();updatePreview()">&#10005;</button></div>').join('');}

function addAttachment(){const n=['إقرار الالتزام بالمحتوى المحلي.pdf','نموذج السيرة الذاتية.docx','جدول الدفعات.xlsx','خطة إدارة المخاطر.pdf'];rfp.attachments.push({name:n[rfp.attachments.length%n.length],size:Math.floor(Math.random()*500+50)+' KB'});renderAttach();addAudit('إضافة','مرفق','',rfp.attachments[rfp.attachments.length-1].name);updatePreview();toast('تم إضافة المرفق');}

function toggleLC(){const t=document.getElementById('toggle-lc');t.classList.toggle('on');rfp.includeLC=t.classList.contains('on');updatePreview();}

function updatePreview(){const p=document.getElementById('preview-content');if(!p)return;const tn={roads:'طرق وبنية تحتية',it:'تقنية معلومات',consulting:'استشارات'};
const ps='<div style="font-size:11.5px;color:var(--text-tertiary);font-style:italic;padding:4px 0">';
let h='<div style="text-align:center;margin-bottom:18px;padding-bottom:14px;border-bottom:2px solid var(--text-primary)"><div style="font-size:12px;color:var(--text-secondary);margin-bottom:2px">'+rfp.entity+'</div><div style="font-size:11px;color:var(--text-tertiary);margin-bottom:6px">وزارة الشؤون البلدية والقروية والإسكان</div><div style="font-size:15px;font-weight:700;line-height:1.5">'+(rfp.title||'عنوان المنافسة')+'</div><div style="font-size:12px;color:var(--text-secondary);margin-top:3px">كراسة الشروط والمواصفات</div><div style="font-size:11px;color:var(--text-tertiary);margin-top:1px">'+rfp.refNum+'</div></div>';

// القسم الأول
h+='<div class="preview-section"><div class="preview-section-title">القسم الأول: مقدمة</div>';
[['الجهة',rfp.entity],['الإدارة',rfp.department],['النوع',tn[rfp.projectType]],['قيمة الوثائق',rfp.docFee?rfp.docFee+' ريال':''],['تاريخ الطرح',rfp.publishDate],['آخر موعد',rfp.deadline],['مدة السريان',rfp.validityDays?rfp.validityDays+' يوم':''],['مدة التنفيذ',rfp.durationMonths?rfp.durationMonths+' شهر':''],['الضمان الابتدائي',rfp.initialGuarantee?rfp.initialGuarantee+'%':''],['الضمان النهائي',rfp.finalGuarantee?rfp.finalGuarantee+'%':'']].forEach(r=>{h+='<div class="preview-field"><span class="preview-field-label">'+r[0]+':</span><span>'+(r[1]||'<span class="preview-placeholder">—</span>')+'</span></div>';});
if(rfp.description)h+='<div style="margin-top:6px;color:var(--text-secondary);font-size:12.5px">'+rfp.description+'</div>';
h+='</div>';

// القسم الثاني
h+='<div class="preview-section"><div class="preview-section-title">القسم الثاني: الأحكام العامة</div>'+ps+'تسري على هذه المنافسة أحكام نظام المنافسات والمشتريات الحكومية ولائحته التنفيذية وملحقاتها والأنظمة ذات العلاقة المعمول بها في المملكة العربية السعودية.</div></div>';

// القسم الثالث
h+='<div class="preview-section"><div class="preview-section-title">القسم الثالث: إعداد العروض</div>'+ps+'يجب أن يتضمن العرض الفني والمالي جميع الوثائق المطلوبة وفقاً لما هو محدد في كراسة الشروط والمواصفات. يُقدم العرض الفني والعرض المالي كل على حدة في مظروفين منفصلين.</div></div>';

// القسم الرابع
h+='<div class="preview-section"><div class="preview-section-title">القسم الرابع: تقديم العروض</div>'+ps+'تُقدم العروض عبر منصة اعتماد (البوابة الإلكترونية للمشتريات الحكومية) خلال المدة المحددة. لا تُقبل العروض المقدمة بعد انتهاء الموعد المحدد.</div></div>';

// القسم الخامس
h+='<div class="preview-section"><div class="preview-section-title">القسم الخامس: تقييم العروض</div>';
h+='<div class="preview-field"><span class="preview-field-label">وزن الفني:</span><span>'+rfp.techWeight+'%</span></div>';
h+='<div class="preview-field"><span class="preview-field-label">وزن المالي:</span><span>'+rfp.finWeight+'%</span></div>';
h+='<div class="preview-field"><span class="preview-field-label">حد أدنى فني:</span><span>'+rfp.minTechScore+'%</span></div>';
if(rfp.evalCriteria.length){h+='<div style="margin-top:6px">';rfp.evalCriteria.forEach(c=>{h+='<div style="display:flex;justify-content:space-between;padding:3px 0;font-size:12px;border-bottom:1px solid var(--border)"><span>'+(c.name||'—')+'</span><span style="font-weight:600">'+c.weight+'%</span></div>';});h+='</div>';}
h+='</div>';

// القسم السادس
h+='<div class="preview-section"><div class="preview-section-title">القسم السادس: متطلبات التعاقد</div>'+ps+'يلتزم المتعاقد بتقديم الضمان النهائي وتوقيع العقد خلال المدة النظامية، وتقديم وثائق التأمين وخطابات الضمان وفقاً لمتطلبات الجهة الحكومية.</div></div>';

// القسم السابع
h+='<div class="preview-section"><div class="preview-section-title">القسم السابع: نطاق العمل المفصل</div>';
if(rfp.deliverables.length)rfp.deliverables.forEach((d,i)=>{h+='<div style="margin-bottom:6px;padding:6px 8px;background:var(--bg);border-radius:6px"><div style="font-weight:600;font-size:12px">'+(i+1)+'. '+(d.name||'—')+'</div>'+(d.criteria?'<div style="font-size:11.5px;color:var(--text-secondary)">معيار: '+d.criteria+'</div>':'')+'</div>';});
else h+='<div class="preview-placeholder">لم تُضف مخرجات</div>';
if(rfp.boqItems.length){h+='<div style="margin-top:10px;font-size:12px;font-weight:600;margin-bottom:4px">جدول الكميات والأسعار:</div><table style="width:100%;font-size:11.5px;border-collapse:collapse"><tr style="border-bottom:1px solid var(--border)"><th style="text-align:right;padding:3px">م</th><th style="text-align:right;padding:3px">البند</th><th style="text-align:right;padding:3px">الوحدة</th><th style="text-align:right;padding:3px">الكمية</th></tr>';rfp.boqItems.forEach((b,i)=>{h+='<tr style="border-bottom:1px solid var(--border)"><td style="padding:2px">'+(i+1)+'</td><td style="padding:2px">'+b.desc+'</td><td style="padding:2px">'+b.unit+'</td><td style="padding:2px">'+b.qty+'</td></tr>';});h+='</table>';}
h+='</div>';

// القسم الثامن
h+='<div class="preview-section"><div class="preview-section-title">القسم الثامن: المواصفات</div>';
if(rfp.specs&&rfp.specs.length)rfp.specs.forEach(s=>{h+='<div style="margin-bottom:4px"><div style="font-weight:600;font-size:12px">'+s.title+'</div><div style="font-size:11.5px;color:var(--text-secondary)">'+(s.content||'—')+'</div></div>';});
h+='</div>';

// القسم التاسع
h+='<div class="preview-section"><div class="preview-section-title">القسم التاسع: متطلبات المحتوى المحلي</div><div class="preview-field"><span class="preview-field-label">النسبة المستهدفة:</span><span>'+rfp.localContentPct+'%</span></div>';
if(rfp.localNotes)h+='<div style="font-size:11.5px;color:var(--text-secondary);margin-top:4px">'+rfp.localNotes+'</div>';
h+='</div>';

// القسم العاشر
h+='<div class="preview-section"><div class="preview-section-title">القسم العاشر: الشروط الخاصة</div><div style="font-size:12px;color:var(--text-secondary);white-space:pre-line">'+(rfp.specialConditions||'—')+'</div></div>';

// القسم الحادي عشر
h+='<div class="preview-section"><div class="preview-section-title">القسم الحادي عشر: ضوابط الأداء</div>'+ps+'تُحدد مؤشرات الأداء الرئيسية (KPIs) وآلية قياس الأداء وجدول الدفعات المرتبط بالإنجاز ضمن العقد النهائي بين الجهة والمتعاقد.</div></div>';

// القسم الثاني عشر
h+='<div class="preview-section"><div class="preview-section-title">القسم الثاني عشر: الملاحق</div>';
if(rfp.attachments.length)rfp.attachments.forEach(a=>{h+='<div style="font-size:12px;padding:2px 0">&#128206; '+a.name+'</div>';});
else h+='<div class="preview-placeholder">لم تُرفق ملفات</div>';
h+='</div>';

// القسم الثالث عشر
h+='<div class="preview-section"><div class="preview-section-title">القسم الثالث عشر: جدول الالتزام</div>'+ps+'يتعين على المتنافس تعبئة جدول الالتزام المرفق والتوقيع عليه وتقديمه ضمن وثائق العرض الفني، مع الإقرار بالالتزام بجميع الشروط والمواصفات الواردة في هذه الكراسة.</div></div>';

p.innerHTML=h;}

function addAudit(action,field,o,n){const t=new Date().toLocaleTimeString('ar-SA',{hour:'2-digit',minute:'2-digit'});auditLog.unshift({time:t,action:action,field:field,user:'خالد'});}

function renderAuditLog(){const l=document.getElementById('audit-log-list');if(!auditLog.length){l.innerHTML='<div style="color:var(--text-tertiary);text-align:center;padding:40px 0">لا توجد إجراءات مسجلة</div>';return;}l.innerHTML=auditLog.slice(0,50).map(a=>'<div class="audit-item"><div class="audit-time">'+a.time+'</div><div class="audit-dot"></div><div><span class="audit-field">'+a.action+'</span> <span style="color:var(--text-secondary)">— '+a.field+'</span><div style="font-size:11.5px;color:var(--text-tertiary)">'+a.user+'</div></div></div>').join('');}

function getChecks(){const c=[{label:'عنوان المنافسة',s:rfp.title?'pass':'fail'},{label:'الجهة الحكومية',s:rfp.entity?'pass':'fail'},{label:'تاريخ طرح الكراسة',s:rfp.publishDate?'pass':'fail'},{label:'مدة سريان العروض',s:rfp.validityDays?'pass':'fail'},{label:'الضمان الابتدائي',s:rfp.initialGuarantee?'pass':'fail'},{label:'نطاق العمل (≥3 مخرجات)',s:rfp.deliverables.length>=3?'pass':rfp.deliverables.length>0?'warn':'fail'},{label:'معايير التقييم (=100%)',s:rfp.evalCriteria.reduce((s,c)=>s+(c.weight||0),0)===100?'pass':'warn'},{label:'المرفقات (≥1)',s:rfp.attachments.length>=1?'pass':'fail'}];
const pass=c.filter(x=>x.s==='pass').length,fail=c.filter(x=>x.s==='fail').length;
const ov=fail>0?'fail':c.some(x=>x.s==='warn')?'warn':'pass';
return{checks:c,overall:ov,label:{pass:'مكتمل',warn:'تحذيرات',fail:'غير مكتمل'}[ov],pass:pass,total:c.length};}

function renderCompPanel(){const{checks,overall,label,pass,total}=getChecks();const sc={pass:'score-pass',warn:'score-warn',fail:'score-fail'}[overall];const ic={pass:'ci-pass',warn:'ci-warn',fail:'ci-fail'};const ix={pass:'&#10003;',warn:'!',fail:'&#10005;'};document.getElementById('compliance-panel').innerHTML='<div class="compliance-header"><span style="font-weight:600;font-size:14px">فحص الامتثال</span><span class="compliance-score '+sc+'">'+label+' — '+pass+'/'+total+'</span></div>'+checks.map(c=>'<div class="compliance-item"><div class="ci '+ic[c.s]+'">'+ix[c.s]+'</div><span>'+c.label+'</span></div>').join('');}

function renderInlineComp(){const{checks,overall,label,pass,total}=getChecks();const sc={pass:'score-pass',warn:'score-warn',fail:'score-fail'}[overall];const ic={pass:'ci-pass',warn:'ci-warn',fail:'ci-fail'};const ix={pass:'&#10003;',warn:'!',fail:'&#10005;'};document.getElementById('inline-compliance').innerHTML='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px"><span style="font-size:13px">حالة الامتثال</span><span class="compliance-score '+sc+'">'+label+' — '+pass+'/'+total+'</span></div>'+checks.map(c=>'<div style="display:flex;align-items:center;gap:8px;padding:4px 0;font-size:13px"><div class="ci '+ic[c.s]+'">'+ix[c.s]+'</div>'+c.label+'</div>').join('');}

function renderApprovals(){const k=document.getElementById('approvals-kanban');const cols={pending:{t:'مطلوب',items:[]},review:{t:'قيد المراجعة',items:[]},approved:{t:'معتمد',items:[]}};approvalItems.forEach(a=>cols[a.status].items.push(a));k.innerHTML=Object.entries(cols).map(([key,col])=>'<div class="kanban-col"><div class="kanban-col-title">'+col.t+' <span class="kanban-count">'+col.items.length+'</span></div>'+col.items.map(item=>{const idx=approvalItems.indexOf(item);return'<div class="kanban-card"><div class="kanban-role">'+item.role+'</div><div class="kanban-desc">'+item.desc+'</div><div style="display:flex;gap:6px">'+(key==='pending'?'<button class="btn btn-sm btn-outline" onclick="moveApp('+idx+',\'review\')">بدء المراجعة</button>':'')+(key==='review'?'<button class="btn btn-sm btn-accent" onclick="moveApp('+idx+',\'approved\')">اعتماد</button><button class="btn btn-sm btn-outline" onclick="moveApp('+idx+',\'pending\')">طلب تعديل</button>':'')+(key==='approved'?'<span style="font-size:12px;color:var(--success)">&#10003; تم</span>':'')+'</div></div>';}).join('')+'</div>').join('');}

function renderInlineKanban(){const el=document.getElementById('inline-kanban');const cols={pending:{t:'مطلوب',items:[]},review:{t:'قيد المراجعة',items:[]},approved:{t:'معتمد',items:[]}};approvalItems.forEach(a=>cols[a.status].items.push(a));el.innerHTML=Object.entries(cols).map(([key,col])=>'<div class="kanban-col"><div class="kanban-col-title">'+col.t+' <span class="kanban-count">'+col.items.length+'</span></div>'+col.items.map(item=>{const idx=approvalItems.indexOf(item);return'<div class="kanban-card"><div class="kanban-role">'+item.role+'</div><div class="kanban-desc">'+item.desc+'</div><div style="display:flex;gap:6px">'+(key==='review'?'<button class="btn btn-sm btn-accent" onclick="moveApp('+idx+',\'approved\');renderInlineKanban()">اعتماد</button>':'')+(key==='pending'?'<button class="btn btn-sm btn-outline" onclick="moveApp('+idx+',\'review\');renderInlineKanban()">بدء</button>':'')+(key==='approved'?'<span style="font-size:12px;color:var(--success)">&#10003;</span>':'')+'</div></div>';}).join('')+'</div>').join('');}

function moveApp(i,s){approvalItems[i].status=s;addAudit('اعتماد',approvalItems[i].role,'','');renderApprovals();toast('تم تحديث حالة '+approvalItems[i].role);}

let selT='roads';
function openWizard(){document.getElementById('wizard-modal').classList.add('active');}
function selType(el,t){document.querySelectorAll('.type-card').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');selT=t;}

function createFromWizard(){const t=document.getElementById('wiz-title').value||'منافسة جديدة';rfp.title=t;rfp.entity=document.getElementById('wiz-entity').value;rfp.department=document.getElementById('wiz-dept').value;rfp.projectType=selT;rfp.refNum='RFP-2026-'+String(Math.floor(Math.random()*900+100));document.getElementById('f-title').value=rfp.title;document.getElementById('f-entity').value=rfp.entity;document.getElementById('f-dept').value=rfp.department;document.getElementById('f-type').value=rfp.projectType;document.getElementById('f-refnum').value=rfp.refNum;document.getElementById('builder-title').textContent=rfp.title;initSpecs();closeModal('wizard-modal');navigate('builder');goStep(0);addAudit('إنشاء','منافسة جديدة','',rfp.title);toast('تم إنشاء المنافسة بنجاح');}

function mockExport(){document.getElementById('export-modal').classList.add('active');}
function downloadExport(){const t=document.getElementById('preview-content').innerText;const b=new Blob([t],{type:'text/plain;charset=utf-8'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='كراسة_الشروط_والمواصفات.txt';a.click();URL.revokeObjectURL(u);closeModal('export-modal');toast('تم تحميل الملف بنجاح');addAudit('تصدير','كراسة الشروط','','PDF');}

function showEtimad(){const items=['كراسة الشروط والمواصفات (PDF)','جدول الكميات والأسعار (Excel)','نموذج العرض الفني','نموذج العرض المالي','نموذج خطاب الضمان الابتدائي','المخططات الهندسية','شهادة المحتوى المحلي','إقرار السرية وعدم تضارب المصالح'];document.getElementById('etimad-checklist').innerHTML=items.map(i=>'<div class="checklist-item"><div class="checklist-check" onclick="this.classList.toggle(\'checked\')">&#10003;</div><span>'+i+'</span></div>').join('');document.getElementById('etimad-modal').classList.add('active');}

function closeModal(id){document.getElementById(id).classList.remove('active');}
function toast(m){const c=document.getElementById('toast-container');const t=document.createElement('div');t.className='toast';t.innerHTML='&#10003; '+m;c.appendChild(t);setTimeout(()=>t.remove(),3200);}

document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',function(e){if(e.target===this)this.classList.remove('active')}));

initDeliverables();initSpecs();initEval();initBOQ();initAttach();updatePreview();renderCompPanel();renderApprovals();renderAuditLog();addAudit('إنشاء','منافسة جديدة','',rfp.title);
</script>
</body>
</html>
